---
title: Ubuntu从18.04升级到18.10
tags:
 - ubuntu
---

不负众望呀，本人在公司的主力PC在从Ubuntu 18.04升级到Ubuntu 18.10时，又双叒叕扑街了，记得我之前也写过一篇blog记录：[Ubuntu从17.04升级到17.10](/2017/11/05/ubuntu-upgrade-to-17-10)．

# 升级
按照[How to Upgrade to Ubuntu 18.10 from Ubuntu 18.04 LTS](https://www.omgubuntu.co.uk/2018/10/how-to-upgrade-to-ubuntu-18-10)，首先修改更新配置，只要由新版本就更新：

> 1. Open the “Software & Updates” app
> 2. Tap the “Updates” tab
> 3. Find the section titled “Notify me of a new Ubuntu version”
> 4. Set ‘For long-term support versions’ to ‘For any new version’
> 5. Click ‘Close’

接着：
```bash
sudo do-release-upgrade -d
```

这次在升级过程中，一切顺利什么事没有，重启之后就宕机了。

<!--more-->

# 症状
GRUB启动正常，选择进入Ubuntu之后，屏幕出现Ubuntu logo，若干秒之后，黑屏，刷启动各种service和systemd service的log，刷到dnsmasq之后，死机......

# 修复
重启进入recovery模式中的root终端，`ifconfig`使用不能，提示用`ip`或者装`net-tools`[^1]。

[^1]: 原来我用了十几年的`ifconfig`早就被淘汰了，现在要用`ip`这个命令行工具，比如原来你看ip的命令是`ifconfig`，现在是`ip address show`，或者`ip a`

好吧，试试`apt`，提示无法解析域名，查看`/etc/resolv.conf`中显示的内容是：

```txt
# Generated by NetworkManager
nameserver 127.0.0.53
```

联想到正常启动时，死机之前最后的log，误以为是dnsmasq挂了，Google查了一下别人的解决方案，把`/etc/systemd/resolved.conf`各种改，什么`DNSStubListener=no`都尝试一边，一顿操作没有任何好转，考虑到`NetworkManager`臭名昭著，断网与此无关，可能和公司有线网的802.11x认证有关，觉得重新分析问题，不再纠结断网。

# 解决
Google查找升级死机的时候，偶然看到有人提到nvidia，嗯，说不定又是它。一顿猛操作：

```bash
apt purge nvidia*
```

干掉了上百兆的NVidia相关包，内核启动镜像也重新生成了。重启之后，一切都正常了，但是我不信邪，加了最新nvidia显卡驱动的ppa源，把所有的版本nvidia驱动都试了一遍，果然除了自带的`Nouveau`，其它版本全部死机。好在`Nouveau`也可以用`gnome-shell`的特效，跑`Unity3D`也没什么问题，就这样吧，开心。

# btw
升级完了之后，少不了一番折腾，比如干掉了难看的`GDM3`登陆界面背景图；解决了`Unity3D`无法启动的问题。

## 编辑GDM3登录界面背景图
编辑`/etc/alternatives/gdm3.css`中的`lockDialogGroup`：

```css
#lockDialogGroup {
  background: #2c001e url(file:///usr/share/backgrounds/Ubuntu_Party_de_Paris_by_Marcos_Costales.jpg);
  background-repeat: no-repeat;
  background-size: cover;
  background-position: center; }
```

## 更新Unity3D
`Unity3D`不能启动了，重新下载一个最新版的[Unity-2018.2.7f1](https://forum.unity.com/threads/unity-on-linux-release-notes-and-known-issues.350256/page-2#post-3662605)，顺利打开，之前的工程也顺利导入。
