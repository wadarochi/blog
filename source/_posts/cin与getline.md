---
title: cin与getline
tags: []
date: 2011-04-18 22:34:00
---

初学C++的同学常常会遇到这样一个问题：如何从标准输入流中输入一个带有空格的句子？通过不断的Google或者翻书，往往会发现个``getline''这个全局函数，它可以从标准输入输出流中拿到一行，并且输入参数是string类型：
> istream&amp; getline ( istream&amp; is, string&amp; str, char delim );
> istream&amp; getline ( istream&amp; is, string&amp; str );
不过一旦动手就会遇到一个新问题：cin &gt;&gt;和getline混用的时候会出错，比如：
<pre style="-qt-block-indent: 0; background-color: #11121a; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;"><span style="color: #349d58; font-family: 'Consolas'; font-size: 10pt;">01</span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;"> </span><span style="color: #b0b0b0; font-family: 'Consolas'; font-size: 10pt;">...</span></pre><pre style="-qt-block-indent: 0; background-color: #11121a; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;"><span style="color: #349d58; font-family: 'Consolas'; font-size: 10pt;">02 </span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;">    </span><span style="color: #0490e8; font-family: 'Consolas'; font-size: 10pt; font-weight: 600;">int</span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;"> var</span><span style="color: #b0b0b0; font-family: 'Consolas'; font-size: 10pt;">;</span></pre><pre style="-qt-block-indent: 0; background-color: #11121a; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;"><span style="color: #349d58; font-family: 'Consolas'; font-size: 10pt;">03 </span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;">    string name</span><span style="color: #b0b0b0; font-family: 'Consolas'; font-size: 10pt;">;</span></pre><pre style="-qt-block-indent: 0; background-color: #11121a; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;"><span style="color: #349d58; font-family: 'Consolas'; font-size: 10pt;">04 </span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;">    </span><span style="color: #b0b0b0; font-family: 'Consolas'; font-size: 10pt;">...</span></pre><pre style="-qt-block-indent: 0; background-color: #11121a; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;"><span style="color: #349d58; font-family: 'Consolas'; font-size: 10pt;">05 </span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;">    cin </span><span style="color: #b0b0b0; font-family: 'Consolas'; font-size: 10pt;">&gt;&gt;</span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;"> var</span><span style="color: #b0b0b0; font-family: 'Consolas'; font-size: 10pt;">;</span></pre><pre style="-qt-block-indent: 0; background-color: #11121a; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;"><span style="color: #349d58; font-family: 'Consolas'; font-size: 10pt;">06 </span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;">    </span><span style="color: #b4e09f; font-family: 'Consolas'; font-size: 10pt;">getline</span><span style="color: #b0b0b0; font-family: 'Consolas'; font-size: 10pt;">(</span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;">cin</span><span style="color: #b0b0b0; font-family: 'Consolas'; font-size: 10pt;">,</span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;"> name</span><span style="color: #b0b0b0; font-family: 'Consolas'; font-size: 10pt;">);</span></pre><pre style="-qt-block-indent: 0; background-color: #11121a; margin-bottom: 12px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;"><span style="color: #349d58; font-family: 'Consolas'; font-size: 10pt;">07 </span><span style="color: #b0b0b0; font-family: 'Consolas'; font-size: 10pt;">...</span> </pre>运行之后，你会发现你只能输入一次，当你输入了``var''这个变量的值之后，``getline(cin, name)''这一行会被跳过，仿佛没有执行过一般，这是怎么回事？

这里我们需要了解流提取操作符``&gt;&gt;''的一些特点，这个重载过的操作符的实现的功能顾名思义就是从输入缓冲中提取一个词，再将这个词转化为它后面的变量的类型，比如：<span style="color: #349d58; font-family: 'Consolas'; font-size: 10pt;"> </span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;"></span>
<pre style="-qt-block-indent: 0; background-color: #11121a; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;"><span style="color: #349d58; font-family: 'Consolas'; font-size: 10pt;">01 </span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;">#include <cstdlib></cstdlib></span></pre>
<pre style="-qt-block-indent: 0; background-color: #11121a; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;"><span style="color: #349d58; font-family: 'Consolas'; font-size: 10pt;">02 </span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;">#include <iostream></iostream></span></pre><pre style="-qt-block-indent: 0; background-color: #11121a; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;"><span style="color: #349d58; font-family: 'Consolas'; font-size: 10pt;">03 </span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;">#include <string></string></span></pre><pre style="-qt-block-indent: 0; background-color: #11121a; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;"><span style="color: #349d58; font-family: 'Consolas'; font-size: 10pt;">04 </span></pre><pre style="-qt-block-indent: 0; background-color: #11121a; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;"><span style="color: #349d58; font-family: 'Consolas'; font-size: 10pt;">05 </span><span style="color: #fca8ad; font-family: 'Consolas'; font-size: 10pt;">using namespace</span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;"> std</span><span style="color: #b0b0b0; font-family: 'Consolas'; font-size: 10pt;">;</span></pre><pre style="-qt-block-indent: 0; background-color: #11121a; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;"><span style="color: #349d58; font-family: 'Consolas'; font-size: 10pt;">06 </span></pre><pre style="-qt-block-indent: 0; background-color: #11121a; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;"><span style="color: #349d58; font-family: 'Consolas'; font-size: 10pt;">07 </span><span style="color: #0490e8; font-family: 'Consolas'; font-size: 10pt; font-weight: 600;">int</span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;"> </span><span style="color: #b4e09f; font-family: 'Consolas'; font-size: 10pt;">main</span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;"> </span><span style="color: #b0b0b0; font-family: 'Consolas'; font-size: 10pt;">(</span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;"> </span><span style="color: #0490e8; font-family: 'Consolas'; font-size: 10pt; font-weight: 600;">int</span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;"> argc</span><span style="color: #b0b0b0; font-family: 'Consolas'; font-size: 10pt;">,</span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;"> </span><span style="color: #0490e8; font-family: 'Consolas'; font-size: 10pt; font-weight: 600;">char</span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;"> </span><span style="color: #b0b0b0; font-family: 'Consolas'; font-size: 10pt;">*</span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;">argv</span><span style="color: #b0b0b0; font-family: 'Consolas'; font-size: 10pt;">[] )</span></pre><pre style="-qt-block-indent: 0; background-color: #11121a; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;"><span style="color: #349d58; font-family: 'Consolas'; font-size: 10pt;">08 </span><span style="color: #b0b0b0; font-family: 'Consolas'; font-size: 10pt;">{</span></pre><pre style="-qt-block-indent: 0; background-color: #11121a; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;"><span style="color: #349d58; font-family: 'Consolas'; font-size: 10pt;">09 </span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;">    string str1</span><span style="color: #b0b0b0; font-family: 'Consolas'; font-size: 10pt;">;</span></pre><pre style="-qt-block-indent: 0; background-color: #11121a; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;"><span style="color: #349d58; font-family: 'Consolas'; font-size: 10pt;">10 </span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;">    streamsize  size</span><span style="color: #b0b0b0; font-family: 'Consolas'; font-size: 10pt;">;</span></pre><pre style="-qt-block-indent: 0; background-color: #11121a; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;"><span style="color: #349d58; font-family: 'Consolas'; font-size: 10pt;">11 </span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;">    </span><span style="color: #349d58; font-family: 'Consolas'; font-size: 10pt;">// if you use Visual Studio, next line is unnecessary, comment it.</span></pre><pre style="-qt-block-indent: 0; background-color: #11121a; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;"><span style="color: #349d58; font-family: 'Consolas'; font-size: 10pt;">12 </span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;">    ios</span><span style="color: #b0b0b0; font-family: 'Consolas'; font-size: 10pt;">::</span><span style="color: #b4e09f; font-family: 'Consolas'; font-size: 10pt;">sync_with_stdio</span><span style="color: #b0b0b0; font-family: 'Consolas'; font-size: 10pt;">(</span><span style="color: #fca8ad; font-family: 'Consolas'; font-size: 10pt;">false</span><span style="color: #b0b0b0; font-family: 'Consolas'; font-size: 10pt;">);</span></pre><pre style="-qt-block-indent: 0; background-color: #11121a; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;"><span style="color: #349d58; font-family: 'Consolas'; font-size: 10pt;">13 </span></pre><pre style="-qt-block-indent: 0; background-color: #11121a; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;"><span style="color: #349d58; font-family: 'Consolas'; font-size: 10pt;">14 </span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;">    cout </span><span style="color: #b0b0b0; font-family: 'Consolas'; font-size: 10pt;">&lt;&lt;</span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;"> </span><span style="color: #5c78f0; font-family: 'Consolas'; font-size: 10pt;">"Input : "</span><span style="color: #b0b0b0; font-family: 'Consolas'; font-size: 10pt;">;</span></pre><pre style="-qt-block-indent: 0; background-color: #11121a; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;"><span style="color: #349d58; font-family: 'Consolas'; font-size: 10pt;">15 </span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;">    cin </span><span style="color: #b0b0b0; font-family: 'Consolas'; font-size: 10pt;">&gt;&gt;</span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;"> str1</span><span style="color: #b0b0b0; font-family: 'Consolas'; font-size: 10pt;">;</span></pre><pre style="-qt-block-indent: 0; background-color: #11121a; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;"><span style="color: #349d58; font-family: 'Consolas'; font-size: 10pt;">16 </span></pre><pre style="-qt-block-indent: 0; background-color: #11121a; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;"><span style="color: #349d58; font-family: 'Consolas'; font-size: 10pt;">17 </span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;">    streambuf </span><span style="color: #b0b0b0; font-family: 'Consolas'; font-size: 10pt;">*</span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;">pBuf </span><span style="color: #b0b0b0; font-family: 'Consolas'; font-size: 10pt;">=</span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;"> cin</span><span style="color: #b0b0b0; font-family: 'Consolas'; font-size: 10pt;">.</span><span style="color: #b4e09f; font-family: 'Consolas'; font-size: 10pt;">rdbuf</span><span style="color: #b0b0b0; font-family: 'Consolas'; font-size: 10pt;">();</span></pre><pre style="-qt-block-indent: 0; background-color: #11121a; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;"><span style="color: #349d58; font-family: 'Consolas'; font-size: 10pt;">18 </span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;">    size    </span><span style="color: #b0b0b0; font-family: 'Consolas'; font-size: 10pt;">=</span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;"> pBuf</span><span style="color: #b0b0b0; font-family: 'Consolas'; font-size: 10pt;">-&gt;</span><span style="color: #b4e09f; font-family: 'Consolas'; font-size: 10pt;">in_avail</span><span style="color: #b0b0b0; font-family: 'Consolas'; font-size: 10pt;">();</span></pre><pre style="-qt-block-indent: 0; background-color: #11121a; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;"><span style="color: #349d58; font-family: 'Consolas'; font-size: 10pt;">19 </span></pre><pre style="-qt-block-indent: 0; background-color: #11121a; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;"><span style="color: #349d58; font-family: 'Consolas'; font-size: 10pt;">20 </span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;">    cout </span><span style="color: #b0b0b0; font-family: 'Consolas'; font-size: 10pt;">&lt;&lt;</span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;"> </span><span style="color: #5c78f0; font-family: 'Consolas'; font-size: 10pt;">"Your input is : "</span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;"> </span><span style="color: #b0b0b0; font-family: 'Consolas'; font-size: 10pt;">&lt;&lt;</span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;"> str1 </span><span style="color: #b0b0b0; font-family: 'Consolas'; font-size: 10pt;">&lt;&lt;</span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;"> endl</span><span style="color: #b0b0b0; font-family: 'Consolas'; font-size: 10pt;">;</span></pre><pre style="-qt-block-indent: 0; background-color: #11121a; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;"><span style="color: #349d58; font-family: 'Consolas'; font-size: 10pt;">21 </span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;">    cout </span><span style="color: #b0b0b0; font-family: 'Consolas'; font-size: 10pt;">&lt;&lt;</span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;"> </span><span style="color: #5c78f0; font-family: 'Consolas'; font-size: 10pt;">"There is still "</span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;"> </span><span style="color: #b0b0b0; font-family: 'Consolas'; font-size: 10pt;">&lt;&lt;</span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;"> size </span><span style="color: #b0b0b0; font-family: 'Consolas'; font-size: 10pt;">&lt;&lt;</span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;"> </span><span style="color: #5c78f0; font-family: 'Consolas'; font-size: 10pt;">" chars in the buffer."</span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;"> </span><span style="color: #b0b0b0; font-family: 'Consolas'; font-size: 10pt;">&lt;&lt;</span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;"> endl</span><span style="color: #b0b0b0; font-family: 'Consolas'; font-size: 10pt;">;</span></pre><pre style="-qt-block-indent: 0; background-color: #11121a; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;"><span style="color: #349d58; font-family: 'Consolas'; font-size: 10pt;">22 </span></pre><pre style="-qt-block-indent: 0; background-color: #11121a; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;"><span style="color: #349d58; font-family: 'Consolas'; font-size: 10pt;">23 </span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;">    </span><span style="color: #fca8ad; font-family: 'Consolas'; font-size: 10pt;">return</span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;"> EXIT_SUCCESS</span><span style="color: #b0b0b0; font-family: 'Consolas'; font-size: 10pt;">;</span></pre><pre style="-qt-block-indent: 0; background-color: #11121a; margin-bottom: 12px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;"><span style="color: #349d58; font-family: 'Consolas'; font-size: 10pt;">24 </span><span style="color: #b0b0b0; font-family: 'Consolas'; font-size: 10pt;">}</span><span style="color: #a0b4e0; font-family: 'Consolas'; font-size: 10pt;">               </span><span style="color: #349d58; font-family: 'Consolas'; font-size: 10pt;">// ----------  end of function main  ----------</span> </pre>假如你在第15行的``cin &gt;&gt; str1''处输入了``Hello World!''，cin第一次只读入Hello，后面8个字符仍在输入缓冲中，所以第21行会输出``There is still 8 chars in the buffer.''。换句话说，``&gt;&gt;''读到下一个空白字符的前一个字符，不过它将空白字符留在输入缓冲中。

也就是因为这一点，``getline''和``&gt;&gt;''混用的时候会有小摩擦，考虑本文的第一个例子，当在``cin &gt;&gt; var''中输入3然后回车之后，`3'作为数字被赋值给了``var''，但是换行符被留在了输入缓冲中，``getline(cin, name);''在读入换行符之后就认为已经读到了一整行：
> Extracts characters from is and stores them into str until a delimitation character is found.
> 
> The delimiter character is delim for the first function version, and '\n' (newline character) for the second. The extraction also stops if the end of file is reached in is or if some other error occurs during the input operation.
> 
> If the delimiter is found, it is extracted and discarded, i.e. it is not stored and the next input operation will begin after it.上面这一段是cplusplus上对getline函数的说明：http://www.cplusplus.com/reference/string/getline/，大意就是说``getline''在输入缓冲读入输入的时候是从第一个字符开始，并且再读入之后，将换行符从输入缓冲中删掉(这个才是好的行为啊)

由以上两点不难理解为什么跟在``&gt;&gt;''之后的``getline''会被跳掉，其实不是被跳掉，而是读了一个换行符`\n'就收工了……

那么怎么解决呢？

1.  不要混用``cin''和``getline''；
2.  在使用``cin''之后调用``cin.ignore(256, '\n')''，将输入缓冲中的换行符清空掉……